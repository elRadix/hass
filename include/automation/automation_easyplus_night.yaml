- id: easyplus_night_1
  initial_state: 'true'
  alias: 'Night Modus Notification'
  trigger:
    platform: time
    at: '00:25:00'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_boolean.night
        state: 'on'  
      - condition: state
        entity_id: group.easyplus_lights
        state: 'on'
      - condition: state
        entity_id: switch.easyplus
        state: 'on'
  action:
  - service: telegram_bot.send_message
    data_template:
      title: 'Night Modus will start over 5min'
      target: 1999381, 13971596
      message: 'What shall we do now?'
      inline_keyboard:
        - "Shutdown:/night_now"
        - "Delay:/night_delay"
  - service: telegram_bot.send_message
    data_template:
      title: 'Night Modus will start over 5min'
      target: 13971596
      message: 'What shall we do now?'
      inline_keyboard:
        - "Shutdown:/night_now"
        - "Delay:/night_delay"

- id: easyplus_night_2
  initial_state: 'true'
  alias: 'Night Modus TG Now'
  trigger:
  - platform: event
    event_type: telegram_callback
    event_data:
      command: '/night_now'
  action:
  - service: script.lights
  - service: script.switches
  - delay:
      seconds: 10
  - service: homeassistant.turn_off
    entity_id: switch.easyplus        
  - service: telegram_bot.send_message
    data_template:
      target: '{{ trigger.event.data.user_id }}'
      message: '

      You have selected Night Modus, House shutdown'

- id: easyplus_night_3
  initial_state: 'true'
  alias: 'Night Modus TG Delay'
  trigger:
  - platform: event
    event_type: telegram_callback
    event_data:
      data: '/night_delay'
  action:
  - service: homeassistant.turn_off
    entity_id: input_boolean.night 
  - service: telegram_bot.send_message
    data_template:
      target: '{{ trigger.event.data.user_id }}'
      message: '

      Night Modus has been delayed'

- id: easyplus_night_4
  initial_state: 'true'
  alias: 'Night Modus Lights Off'
  trigger:
    platform: time
    at: '00:30:00'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_boolean.night
        state: 'on'    
      - condition: state
        entity_id: group.easyplus_lights
        state: 'on'
      - condition: state
        entity_id: switch.easyplus
        state: 'on'
  action:
  - service: script.lights
  - service: notify.dageraad
    data:
      message: "Night Modus, Lights Off"

- id: easyplus_night_5
  initial_state: 'true'
  alias:  'Night Modus Switches Off'
  trigger:
    platform: time
    at: '00:30:30'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_boolean.night
        state: 'on'    
      - condition: state
        entity_id: group.easyplus_switches
        state: 'on'
      - condition: state
        entity_id: switch.easyplus
        state: 'on'
  action:
  - service: script.switches
  - service: notify.dageraad
    data:
      message: "Night Modus, Switches Off"

- id: easyplus_night_6
  initial_state: 'true'
  alias: 'Night Modus Easyplus Off' 
  trigger:
    platform: time
    at: '00:30:55'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_boolean.night
        state: 'on'    
      - condition: state
        entity_id: switch.easyplus
        state: 'on'
  action:
  - service: homeassistant.turn_off
    entity_id: switch.easyplus
  - service: notify.dageraad
    data:
      message: "Night Modus, Easyplus Off"